<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Ninety Years of College Football Recruiting</title>
  <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="chosen.css">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43615902-3', 'modeanalytics.com');
      ga('send', 'pageview');

    </script>
</head>
<style>

body {
  width: 950px;
  font: 12px sans-serif;
  font-family: Geneva;
/*  background: #f5f7f7;*/
}

footer {
  font-size: 12px;
  font-family: Geneva;
  color: #75756F;
}

footer a {
  text-decoration: none;
  font-style: italic;
  color: #75756F;
}

footer a:hover {
  text-decoration: underline;
}

.logo { float: left; margin-top: -10px; }
.social-media { float: right; text-align: right; }
.share-right { margin-top: 20px; position: absolute; right: 0px;}
.title { float: center; text-align: center; font-family: Geneva; }

.title p {
  margin: 15px; 
}

.title a {
  color: #75756F;
}

.social-icon {
  text-decoration: none;
  width: 50px;
  height: 50px;
  font-size: 2em;
  margin-left: 3px;
  margin-right: 3px;
  color: #1B3A3E;
  border-bottom: none;
}

.social-icon:hover {
  color: #AACB37;
  border-bottom: none;
  text-decoration: none;
  cursor: pointer;
  text-align: right;
}

#mode-logo {
  height: 50px;
  width: auto;
}

.story {
  height: 100px;
}

.story p {
  padding-left: 20px;
  padding-right: 20px;
  vertical-align: middle;
  margin: 12px;
  font-size:14px;
  font-family: Geneva;
}

.filter {
  float:left;
  margin: 8px;
}

.toggles {
  list-style-type:none;
  display: table;
  margin: 0 auto;
  padding: 0px;
}

.toggles a {
  display:block;
  color:#000;
  padding:7px 12px;
  text-decoration:none
}

.toggles .active a{
  background: #b7b7b7;
  cursor: pointer;
}

.toggles a:hover {
  text-decoration: underline;
  cursor: pointer;
}


.toggles li {
  line-height:12px;
  float:left;
  background: white;
  margin-right:-1px;
  border:1px solid #ddd;
}

.toggles li.active {
  border:1px solid #ccc;
  background: #fed976;
  color: white;
}

.counties {
  fill: none;
}

.cty:hover {
  fill: pink;
}

.states {
  fill: none;
  stroke:  #7b7b7b; 
  stroke-linejoin: round;
}

.d3-tip {
  line-height: 1.5;
  padding: 8px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 0px;
  text-align: center;
}

.legend {
  font-family: Geneva;
  font-size: 14px;
}

.omitted {
  font-style: italic;
  font-size: 10px;
}

.slider-container {
  padding-left:10px;
  position:relative;
  float: left;
  margin-top: 20px;
  margin-bottom:20px;
}

.last-pick .tick {
  stroke: black;
  shape-rendering: crispEdges;
}

.top-slider,
.slider-ticks {
  width: 900px;
  position: relative;
}

.slider-ticks .tick {
  position: absolute;
  border-left: solid 1px #ccc;
  height: 4px;
}

.slider-ticks .tick-label {
  position: absolute;
  top: 6px;
  text-align: center;
  width: 20px;
  left: -10px;
  font-size: 9px;
  color: #75756F;
}   

.slider-directions {
  position: absolute;
  top: -20px;
  padding: 5px;
  font-size: 14px;
}

.reset {
  cursor: pointer;
  color: #75756F;
  text-decoration: underline;
}

.reset-hide {
  visibility: hidden;
}

</style>
<body>
  <div id="fb-root"></div>
  <div class="logo">
    <a href="http://blog.modeanalytics.com">
      <img id="mode-logo" src="http://mode.github.io/blog_assets/mode_logo_200px.png" />
    </a>
  </div>
  <div class="social-media">
    <a href="#" onclick="window.open('http://twitter.com/home?status=90%20years%20of%20college%20football%20recruiting,%20in%20one%20map,%20via%20@modeanalytics:%20http://mode.github.io/blog/2014-02-06-signing-day/index.html','targetWindow','left=300,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=260')" class="social-icon" id="twitter"><i class="icon-twitter"></i></a>
    <a href="#" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'facebook-share-dialog','width=626,height=436'); return false;" class="social-icon" id="facebook"><i class="icon-facebook"></i></a>
    </br>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </div>
  </div>
<div class="title">
  <p style="font-size:24px">Ninety Years of College Football Recruiting<p>
  <p><em style="font-size:12px"><a href="http://blog.modeanalytics.com/niney-years-of-college-football-recruiting/">Read the full post</a></em></p>
  <p><a href="https://twitter.com/modeanalytics" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @twitterapi</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></p>
</div>
<div class="story">
  <p>The map below shows 90 years of D-I football recruiting history. To roughly limit the map to highly-recruited players rather than walk-ons and role players, the map only shows players who were on an NFL roster at some point in their careers. The date filter shows the previous eight recruiting classes (e.g., if the filter is set to 2000, the map shows those classes recruited from 1993 to 2000). The toggles on the right allow you to switch between current conference and historic conference alignments.</p>
</div>
  
<div class="filter">
  <select id="conferenceList" data-placeholder="Filter by conference..." class="chosen-select" style="width:280px;" tabindex="2">
    <option id=""></option>
    <option id="acc">ACC</option>
    <option id="american">American Athletic</option>
    <option id="big-12">Big 12</option>
    <option id="big-8">Big Eight</option>
    <option id="big-east">Big East</option>
    <option id="big-ten">Big Ten</option>
    <option id="big-west">Big West</option>
    <option id="cusa">Conference USA</option>
    <option id="ivy">Ivy</option>
    <option id="mac">Mid-American</option>
    <option id="mvc">Missouri Valley</option>
    <option id="mwc">Mountain West</option>
    <option id="pac-12">Pac 12</option>
    <option id="sec">SEC</option>
    <option id="southern">Southern</option>
    <option id="southland">Southland</option>
    <option id="sun-belt">Sun Belt</option>
    <option id="swc">Southwestern Athletic Conference</option>
    <option id="wac">Western Athletic Conference</option>
    <option id="independents">Independent</option>
    <option id="none">None</option>
    </optgroup>
  </select>
</div>
<div class="filter">
  <select id="schoolList" data-placeholder="Filter by school..." class="chosen-select" style="width:280px;" tabindex="2">
    <option value="all"></option>
  </select>
</div>
<div class="filter">
  <ul class="toggles">
    <li class="switch active" id="current"><a>Current alignment</a></li>
    <li class="switch" id="historic"><a>Historic alignment</a></li>
  </ul>
</div>
<div class="slider-container">
    <span class="slider-directions">Select Year&nbsp;&nbsp;&nbsp;<span class="reset">show all years</span></span>
    <input id= "slider" type="range" class="top-slider" step="1" min="1920" value="2009" max="2009"></input>
    <div class="slider-ticks"></div>
</div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
<script src="chosen.jquery.min.js" type="text/javascript"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>  
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
<script src="crossfilter.v1.min.js"></script>
<script>

// Set SVG and map
var width = 1000,
    height = 550,
    centered;

var projection = d3.geo.conicConformal()
    .rotate([98, 0])
    .center([3, 38])
    .parallels([29.5, 45.5])
    .scale(1200)
    .translate([width / 2, height / 2])
    .precision(.1);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

// Set color scale
var colorScale = d3.scale.quantile()
    .range(colorbrewer.YlOrRd[9]);

var leftTickPadding = .01,
    rightTickPadding = .008,
    totalTickPadding = leftTickPadding + rightTickPadding;

var slider = d3.select(".top-slider");

var tickValues = d3.range(+slider.attr("min"), +slider.attr("max") + 1, +slider.attr("step"));

var tick = d3.select(".slider-ticks").selectAll(".g-tick")
      .data(tickValues)
      .enter()
      .append("div")
      .attr("class", "tick")
      .style("left", function(d, i) { return ((leftTickPadding + i * ((1 - totalTickPadding)/(tickValues.length - 1))) * 100) + "%"; });
  
  tick.append("div")
      .attr("class", "tick-label")
      .text(function(d, i) { return d === 1 ? d : (d % 5 ? "" : d); });

d3.json("counties.json", function(error, us) {
d3.csv("player_list_trim.csv", function(players) {
d3.csv("county_locations.csv", function(countyData) { 
  
  // Assign mapping for hover lookup
  var nameById = d3.map(),
      countById = d3.map(),
      latById = d3.map(),
      longById = d3.map();
  
  countyData.forEach(function(county) { 
    nameById.set(+county.id,county.name);
    latById.set(+county.id,+county.lat);
    longById.set(+county.id,+county.long);
  })
  
  // Year slider
  $("#slider").change( function() {
    $(".reset").removeClass('reset-hide')
    currentFilter.year = $(this).attr('value')
    
    applyYear(currentFilter);
    showCounties();
  });
  
  // Reset year
  $(".reset").click( function() {
    currentFilter.year = null;
    $(this).addClass('reset-hide')
    
    console.log(currentFilter);
    
    applyYear(currentFilter);
    showCounties();
  });
  
  // Toggle between count and population percent
  $("li.switch").click( function() {
    $(".switch").removeClass('active');
    $(this).addClass('active');
    currentFilter.confType = $(this).attr('id');
    
    applyConference(currentFilter);
    showCounties();
  });
  
  // Selectors for conference
  $("select#conferenceList").change(function () {
    var selection = $("select#conferenceList option:selected").attr('id');
    currentFilter.conference = selection;
    
    applyConference(currentFilter);
    showCounties();
  });
  
  // Selector for school
  $("select#schoolList").change(function () {
    var selection = $("select#schoolList option:selected").text();
    currentFilter.school = selection;
    
    applySchool(currentFilter);
    showCounties();
  });
  
  // Define crossfilters for counties, positions, conferences, and schools
  var cross = crossfilter(players),
      countyCross = cross.dimension( function (d) { return d.county; }),
      countyGroup = countyCross.group( function(d) {return d; }),
      schoolCross = cross.dimension( function (d) { return d.school; }),
      currentConfCross = cross.dimension( function (d) { return d.current_conf; }),
      historicConfCross = cross.dimension( function (d) { return d.historic_conf; }),
      yearCross = cross.dimension( function (d) { return d.recruit_year; });
  
  var f = d3.format(",d");
  
  tip = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-10, 0])
    .direction('n')
    .html(function(d) {
      var players = countById.get(d.id);
      if (players === undefined) { players = 0; };
      
      return nameById.get(d.id) + "<br/>Players: " + f(players);
   });
      
  svg.call(tip);
  
  // Draw map
  svg.append("g")
    .attr("class", "counties")
    .selectAll("path")      
      .data(topojson.feature(us, us.objects.counties).features)
    .enter().append("path")
      .attr("class","cty")
      .attr("id",function(d) { return "c" + d.id; })
      .attr("fill","#b7b7b7")
      .attr("d", path)
      .on('mouseover',tip.show)
      .on('mouseout', tip.hide);

  svg.append("path")
      .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
      .attr("class", "states")
      .attr("d", path);
  
  // Set legend    
  svg.append("text")
      .attr("x","670")
      .attr("y","40")
      .attr("id","shown")
      .attr("class","legend")
      .text("Players shown: ");
     
  svg.append("text")
      .attr("x","670")
      .attr("y","55")
      .attr("id","omitted")
      .attr("class","omitted")
      .text("Players from: ");
  
  svg.append("text")
      .attr("x","670")
      .attr("y","70")
      .attr("id","hawaii")
      .attr("class","omitted")
      .text("Players from Hawaii: ");
      
  svg.append("text")
      .attr("x","670")
      .attr("y","85")
      .attr("id","alaska")
      .attr("class","omitted")
      .text("Players from Alaksa: ");

  var bars = svg.selectAll("rect")
      .data(colorbrewer.YlOrRd[9])
        .enter()
        .append("rect")
        .attr("x", function (d,i) { return 70 + (i*15); })
        .attr("y", function (d) { return 440; })
        .attr("height", function (d) { return 15; })
        .attr("width", function (d) { return 15; })
        .style("fill", function(d) { return d; });
  
  svg.append("text")
      .attr("x","40")
      .attr("y","430")
      .attr("class","omitted")
      .text("Fewer players");
  
  svg.append("text")
      .attr("x","180")
      .attr("y","430")
      .attr("class","omitted")
      .text("More players");

  svg.append("circle")
      .attr("r",10)
      .attr("cx",65)
      .attr("cy",480)
      .style("opacity",.8)
      .style("fill","#31a354")
      .style("stroke","black");
      
  svg.append("circle")
      .attr("id","mid")
      .attr("r",10)
      .style("opacity",.8)
      .style("fill","#31a354")
      .style("stroke","black");
        
  svg.append("text")
      .attr("x",80)
      .attr("y",484)
      .attr("class","omitted")
      .text("Geographic mean of players");
  
  // Set current filter and draw initial map
  currentFilter = { school: '', conference: '', confType: 'current', year: 2009 };
  
  applyConference(currentFilter);
  applySchool(currentFilter);
  applyYear(currentFilter);
  populateList(); 
  showCounties();

  function showCounties () {
    
    // Get county object
    var countiesCount = countyGroup.top(2000);
    
    // Set county map for tooltip
    countiesCount.forEach(function(d) { 
      countById.set(+d.key,d.value);
    })
    
    // Render map
    renderTotal(countiesCount);
    
    // Draw legend
    d3.select("#shown")
      .text("Players shown: " + f(onMap));
  
    d3.select("#omitted")
      .text("Players from unknown: " + f(offMap));
      
    d3.select("#hawaii")
      .text("Players from Hawaii: " + f(hi));
      
    d3.select("#alaska")
       .text("Players from Alaska: " + f(ak));
  };
  
  function renderTotal(counties) {
    // Find max and set scale
    var maxCount = countyGroup.top(1)[0].value;
    colorScale.domain([0,Math.log(maxCount)]);
    
    // Find those omitted
    onMap = 0;
    offMap = 0;
    hi = 0;
    ak = 0;
          
    // Draw colors
    counties.forEach(function(d) {
      on = 0;

      var state = Math.round(+d.key/1000);
      
      d3.select("#c" + d.key)
        .attr("fill",function() {
          if (state == 2) {
            on = 1;
            ak += d.value;
          } else if (state == 15) {  
            on = 1;
            hi += d.value;
          } else {
            on = 1;
            onMap += d.value;
            if (d.value == 0) { return "#b7b7b7"; } 
            else { return colorScale(Math.log(d.value)); }
          }
        });
        if (on == 0) { offMap += d.value; }
    })
    
    findCenter(counties);
    
  }
  
  // Filter for year
  function applyYear(filter) {
    var value = filter.year
    
    if (value == null) { yearCross.filter(null); }
    else { yearCross.filter([value-7,value+1]); }
  }
  
  // Fitler for conference
  function applyConference(filter) {
    var value = filter.conference,
        confType = filter.confType;
    
    if (confType == 'current') {
      historicConfCross.filter(null);
      if (value == '') { currentConfCross.filter(null); }
      else { currentConfCross.filterExact(value); }

    } else {
      currentConfCross.filter(null);
      if (value == '') { historicConfCross.filter(null); }
      else { historicConfCross.filterExact(value); }
    }   
  }
  
  // Filter for school
  function applySchool(filter) {
    var value = filter.school;
    
    if (value == '') { schoolCross.filter(null); }
    else { schoolCross.filterExact(value); }
  }
  
  // Populate initial list of schools
  function populateList() {
    var schoolGroup = schoolCross.group( function(d) {return d; });
    var schools = schoolGroup.top(1000);
    
    var select = document.getElementById("schoolList");
    var options = [];
    
    schools.forEach(function (d) { options.push(d.key); })
    
    options.sort();
      for (var i = 0; i < options.length; i++) {
          var opt = options[i];
          var el = document.createElement("option");
          el.textContent = opt;
          el.value = opt;
          select.appendChild(el);
      }
    
    var config = {'.chosen-select': {allow_single_deselect:true}}
    
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }
  }
  
  function findCenter(counties) {
    
    var p = 0;
        x = 0;
        y = 0;
    
    counties.forEach(function(d) {
      var value = d.value,
          lat = latById.get(+d.key),
          lng = longById.get(+d.key);
      if (lat >= 24 && lng >= -150 && lng < 0) {
        p += value;
        x += (value*lat);
        y += (value*lng);
      }    
    });
    
    if (p == 0) {
      svg.select("#mid")
        .transition()
        .attr("r",0)
        .duration(300)
    } else {    
      var midLat = x/p,
          midLng = y/p;
      
      var coordinates = [midLng,midLat];
      var midpoint =  projection(coordinates);
      
      svg.select("#mid")
        .transition()
        .attr("r",10)
        .attr("cx",midpoint[0])
        .attr("cy",midpoint[1])
        .duration(300)
    }
  }
  
});
});
});

</script>
<hr>
</body>
<footer>
  <p>Notes: Shades for player counts are determined on a log scale. Historic conference alignments are determined by the date that each player was recruited. For example, if a player was recruited by Virginia Tech in 2000, that player would be considered a Big East recruit if the historic conference alignment filter is selected, and an ACC player if the current conference alignment filter is selected. Because conference alignment data isn't available prior to 1965, conferences from 1920 to 1965 are assumed to be the same as in 1965. Players are assumed to have been recruited four years prior to the start of their NFL careers.</p>
  
  <p>Sources: Player data from 1920 to 2000 is was provided by <a href="http://www.footballdatabase.com/">FootballDatabase.com</a>; data from 2000 to 2009 was provided by <a href="http://www.nfl.com">NFL.com</a>. Information on conference membership was collected from the <a href="http://www.nytimes.com/newsgraphics/2013/11/30/football-conferences/">New York Times</a> and information for matching hometown to counties was collected from the <a href="http://www.naco.org/Pages/default.aspx">National Association of Counties</a>. County location data was calculated from zip code location data provided by <a href="http://notebook.gaslampmedia.com/download-zip-code-latitude-longitude-city-state-county-csv/">Gaslamp Media</a>. A full list of all the players shown on the map can be found in this <a href="https://github.com/mode/blog/tree/master/2014-02-06-signing-day">GitHub folder</a>.<p></footer> 